<%- include('partials/header') %>

<main class="jobs-page">
    <!-- Page Header -->
    <div class="projects-header" data-aos="fade-in">
        <h1><%- siteContent.jobs.headerTitle %></h1>
        <p class="lead"><%- siteContent.jobs.headerSubtitle %></p>
    </div>

    <div class="container py-5">
        
        <!-- Current Vacancies Section -->
        <section id="vacancies" class="mb-5">
            <h2 class="section-title" data-aos="fade-up"><%- siteContent.jobs.vacanciesTitle %></h2>

            <% if (siteContent.jobs.vacancies && siteContent.jobs.vacancies.length > 0) { %>
                <% siteContent.jobs.vacancies.forEach((job, index) => { %>
                    <div class="job-listing-card" data-aos="fade-up" data-aos-delay="<%= index * 100 %>">
                        <div class="job-card-header">
                            <div>
                                <h3 class="job-title"><%= job.title %></h3>
                                <div class="job-meta">
                                    <span><i class="fas fa-map-marker-alt me-1"></i> <%= job.location %></span>
                                    <span><i class="fas fa-clock me-1"></i> <%= job.type %></span>
                                </div>
                            </div>
                            <button class="btn btn-cta apply-btn" 
                                data-bs-toggle="modal" 
                                data-bs-target="#applicationModal"
                                data-job-title="<%= job.title %>"
                                data-job-location="<%= job.location %>"
                                data-job-type="<%= job.type %>"
                                data-job-description="<%= job.description %>">
                                View & Apply
                            </button>
                        </div>
                        <div class="job-card-body">
                            <p><%= job.summary %></p>
                        </div>
                    </div>
                <% }) %>
            <% } else { %>
                <p data-aos="fade-up">There are currently no open vacancies. Please check back later.</p>
            <% } %>
        </section>

        <!-- Tender Opportunities Section -->
        <section id="tenders">
            <h2 class="section-title" data-aos="fade-up"><%- siteContent.jobs.tendersTitle %></h2>

            <% if (siteContent.jobs.tenders && siteContent.jobs.tenders.length > 0) { %>
                <div class="table-responsive" data-aos="fade-up" data-aos-delay="100">
                    <table class="tenders-table">
                        <thead>
                            <tr>
                                <th>Tender Title</th>
                                <th>Reference No.</th>
                                <th>Closing Date</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% siteContent.jobs.tenders.forEach(tender => { %>
                                <tr>
                                    <td><%= tender.title %></td>
                                    <td><%= tender.reference %></td>
                                    <td><%= new Date(tender.closingDate).toLocaleDateString('en-GB') %></td>
                                    <td><%= tender.description %> For more information, please <a href="/contact">contact us</a>.</td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <p data-aos="fade-up">There are currently no open tenders. Please check back later.</p>
            <% } %>
        </section>
    </div>

    <!-- Job Application Modal -->
    <div class="modal fade" id="applicationModal" tabindex="-1" aria-labelledby="applicationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="applicationModalLabel">Apply for Position</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h3 id="modalJobTitle"></h3>
                    <div class="job-meta mb-4">
                        <span id="modalJobLocation"></span>
                        <span id="modalJobType"></span>
                    </div>
                    <div id="modalJobDescription" class="mb-4"></div>

                    <hr>

                    <h4 class="mt-4">Application Form</h4>
                    <form action="/apply-job" method="POST" enctype="multipart/form-data" class="application-form">
                        <input type="hidden" name="jobTitle" id="formJobTitle">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullName" name="fullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="cv" class="form-label">Upload CV (PDF, DOC, DOCX)</label>
                                <input type="file" class="form-control" id="cv" name="cv" accept=".pdf,.doc,.docx" required>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="coverLetter" class="form-label">Cover Letter (Optional)</label>
                                <textarea class="form-control" id="coverLetter" name="coverLetter" rows="5"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-cta">Submit Application</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<%- include('partials/footer') %>